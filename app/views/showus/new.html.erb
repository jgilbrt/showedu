<h1>New ShowU</h1>

<%= form_with(model: @showu, local: true) do |form| %>
  <% if @showu.errors.any? %>
    <div>
      <h2><%= pluralize(@showu.errors.count, "error") %> prohibited this ShowU from being saved:</h2>
      <ul>
        <% @showu.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :receiver_id, "Who do you want to show this to?" %><br>
    <%= form.collection_select :receiver_id, current_user.following, :id, :username, prompt: "Select a follower" %>
  </div>

  <div>
    <%= form.label :description %><br>
    <%= form.text_area :description %>
  </div>

  <div>
    <%= label_tag :media_type, "Choose media type:" %><br>
    <%= select_tag :media_type, options_for_select(["YouTube", "Image", "Spotify", "TMDB"]), id: "media-type-select", prompt: "Select media type" %>
  </div>

  <div id="youtube-field" style="display: none;">
    <%= form.label :youtube_url, "YouTube Link" %><br>
    <%= form.text_field :youtube_url %>
  </div>

  <div id="image-field" style="display: none;">
    <%= form.label :image_url, "Image Link" %><br>
    <%= form.text_field :image_url %>
  </div>

  <div id="spotify-field" style="display: none;">
    <%= form.label :spotify_url, "Spotify Link" %><br>
    <%= form.text_field :spotify_url %>
  </div>

  <div id="tmdb-field" style="display: none;">
    <%= form.label :tmdb_poster_path, "TMDB Poster Path" %><br>
    <%= form.text_field :tmdb_poster_path %>
  </div>

  <div>
    <%= form.submit "Post ShowU" %>
  </div>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const select = document.getElementById("media-type-select");
    const youtubeField = document.getElementById("youtube-field");
    const imageField = document.getElementById("image-field");
    const spotifyField = document.getElementById("spotify-field");
    const tmdbField = document.getElementById("tmdb-field");

    function toggleFields() {
      youtubeField.style.display = "none";
      imageField.style.display = "none";
      spotifyField.style.display = "none";
      tmdbField.style.display = "none";

      if (select.value === "YouTube") youtubeField.style.display = "block";
      if (select.value === "Image") imageField.style.display = "block";
      if (select.value === "Spotify") spotifyField.style.display = "block";
      if (select.value === "TMDB") tmdbField.style.display = "block";
    }

    select.addEventListener("change", toggleFields);
    toggleFields(); // Show the correct field on initial load (if needed)
  });
</script>
